---
import Layout from "@/layouts/Layout.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import { checkHealth } from "@/utils/apiClient";

// Fetch API health status at build time
const healthResponse = await checkHealth();

// Example: Fetch a document (uncomment when you have data)
// const docResponse = await getDocument('doc_1');
---

<Layout>
  <Header />
  <main id="main-content">
    <section class="prose mb-28 max-w-3xl prose-img:border-0">
      <h1 class="text-2xl tracking-wider sm:text-3xl">API Integration Demo</h1>

      <p>
        This page demonstrates the integration with the custom Cloudflare Workers API.
        The API client utility is located at <code>src/utils/apiClient.ts</code>.
      </p>

      <h2>API Health Check</h2>
      {healthResponse.data ? (
        <div class="border-2 border-accent p-4 rounded-lg my-4">
          <p><strong>Status:</strong> {healthResponse.data.ok ? '✅ Healthy' : '❌ Unhealthy'}</p>
          <p><strong>Timestamp:</strong> {new Date(healthResponse.data.ts).toLocaleString()}</p>
        </div>
      ) : (
        <div class="border-2 border-accent p-4 rounded-lg my-4">
          <p><strong>Error:</strong> {healthResponse.error}</p>
          <p>Make sure your API is running at: <code>{import.meta.env.PUBLIC_API_URL || 'http://localhost:8787'}</code></p>
        </div>
      )}

      <h2>Available API Endpoints</h2>
      <ul>
        <li><code>GET /health</code> - Health check endpoint</li>
        <li><code>GET /d1/init</code> - Initialize database with sample data</li>
        <li><code>GET /d1/docs/:id</code> - Fetch a document by ID</li>
      </ul>

      <h2>Example Usage</h2>
      <p>
        You can use the API client in any Astro component or page:
      </p>
      <pre class="border-2 border-muted p-4 rounded-lg overflow-x-auto"><code>{`import { checkHealth, getDocument } from "@/utils/apiClient";

// Check API health
const health = await checkHealth();

// Fetch a document
const doc = await getDocument('doc_1');`}</code></pre>

      <h2>Environment Configuration</h2>
      <p>
        Configure the API URL by setting the <code>PUBLIC_API_URL</code> environment variable
        in your <code>.env</code> file:
      </p>
      <pre class="border-2 border-muted p-4 rounded-lg overflow-x-auto"><code>PUBLIC_API_URL=http://localhost:8787</code></pre>
    </section>
  </main>
  <Footer />
</Layout>
